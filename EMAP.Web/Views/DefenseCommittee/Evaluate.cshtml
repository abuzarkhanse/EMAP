@using EMAP.Domain.Fyp
@model EMAP.Web.Controllers.Admin.DefenseEvaluateVm

@{
    ViewData["Title"] = "Evaluate Defense";
}

<div class="container py-4">

    <div class="card shadow-sm mb-3">
        <div class="card-body d-flex justify-content-between align-items-center">
            <div>
                <h4 class="mb-0">Evaluate Proposal Defense</h4>
                <small class="text-muted">Group #@Model.GroupId | Proposal #@Model.ProposalId</small>
            </div>
            <a asp-action="Index" class="btn btn-outline-secondary btn-sm">Back</a>
        </div>
    </div>

    <div class="card shadow-sm mb-3">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-8">
                    <div class="fw-bold">@Model.Title</div>
                    <div class="small text-muted">Batch: @Model.Batch</div>
                    <div class="small">
                        <strong>Members:</strong>
                        @Model.Leader
                        @if (!string.IsNullOrWhiteSpace(Model.Member2) && Model.Member2 != "-")
                        {
                            <span>, @Model.Member2</span>
                        }
                        @if (!string.IsNullOrWhiteSpace(Model.Member3) && Model.Member3 != "-")
                        {
                            <span>, @Model.Member3</span>
                        }
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="small">
                        <strong>Date:</strong> @Model.DefenseDate.ToString("dd MMM yyyy")<br />
                        <strong>Time:</strong> @Model.DefenseTime<br />
                        <strong>Duration:</strong> @Model.DurationMinutes min<br />
                        <strong>Venue:</strong> @(string.IsNullOrWhiteSpace(Model.Venue) ? "TBA" : Model.Venue)
                    </div>
                </div>
            </div>

            @if (!string.IsNullOrWhiteSpace(Model.Instructions))
            {
                <hr />
                <div class="small">
                    <strong>Coordinator Instructions:</strong>
                    <div class="p-2 bg-light border rounded mt-1">
                        @Html.Raw(Model.Instructions.Replace("\n", "<br />"))
                    </div>
                </div>
            }
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <form asp-action="Evaluate" method="post">
                @Html.AntiForgeryToken()

                <input type="hidden" asp-for="ProposalId" />
                <input type="hidden" asp-for="GroupId" />
                <input type="hidden" asp-for="Title" />
                <input type="hidden" asp-for="Batch" />
                <input type="hidden" asp-for="Leader" />
                <input type="hidden" asp-for="Member2" />
                <input type="hidden" asp-for="Member3" />
                <input type="hidden" asp-for="DefenseDate" />
                <input type="hidden" asp-for="DefenseTime" />
                <input type="hidden" asp-for="DurationMinutes" />
                <input type="hidden" asp-for="Venue" />
                <input type="hidden" asp-for="Instructions" />

                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" asp-for="IsPresent" />
                    <label class="form-check-label">
                        Group Present
                    </label>
                </div>

                <div class="mb-3">
                    <label class="form-label">Decision</label>
                    <select asp-for="Decision" class="form-select">
                        <option value="@DefenseDecision.Accepted">Accepted</option>
                        <option value="@DefenseDecision.AcceptedWithChanges">Accepted with Changes</option>
                        <option value="@DefenseDecision.Rejected">Rejected</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Committee Feedback</label>
                    <textarea asp-for="Feedback" class="form-control" rows="5"
                              placeholder="Write committee feedback / instructions for student..."></textarea>
                    <span asp-validation-for="Feedback" class="text-danger small"></span>
                </div>

                <button class="btn btn-primary">Save Evaluation</button>
            </form>
        </div>
    </div>
</div>
